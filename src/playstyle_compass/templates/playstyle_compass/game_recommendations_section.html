{% load static %}
{% load custom_filters %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/playstyle_compass/recommendation_section.css' %}">
<link rel="stylesheet" href="{% static 'css/playstyle_compass/reviews.css' %}">
<link rel="stylesheet" href="{% static 'css/lightbox.min.css' %}">
{% endblock %}

<li>
  <div class="game-image">
    {% if game.image %}
    {% if game.calculate_overall_score > 1 %}
    <span>Rating: </span><span class="star-rating"><span class="score-hidden">{{ game.calculate_overall_score }}</span></span> <small><span>({{ game.get_all_scores }} {{ game.get_all_scores|pluralize_reviews }})</span></small></p>
    {% endif %}
    <img src="{{ game.image }}" alt="Game Image">
    {% else %}
    <p><strong>Image not available</strong></p>
    {% endif %}
  </div>
  <div class="game-info">
    <h4>{{ game.title|default:"Game Title not available" }}</h4>
    <p>{{ game.description|default:"Game description not available" }}</p>
    <p><strong>Release date:</strong> {{ game.release_date|default:"N/A"}}</p>
    <p><strong>Developer:</strong> {{ game.developers|default:"N/A"}}</p>
    <p><strong>Genres:</strong> {{ game.genres|default:"N/A" }}</p>
    <p><strong>Platforms:</strong> {{ game.platforms|default:"N/A" }}</p>
    <p><strong>Themes:</strong> {{ game.themes|default:"N/A" }}</p>
    <p><strong>Similar games:</strong> {{ game.similar_games|default:"N/A"}}</p>
    <p><strong>Overview:</strong>
      <span class="overview">{{ game.overview|default:"N/A"|truncatewords_html:"50" }}</span>
      <span class="full-text" style="display: none;">{{ game.overview|default:"N/A" }}</span>
      <button class="read-button" onclick="readMore(this);">[Read more...]</button>
    </p>
    <p>
      <strong>Images:</strong>
      <span><small>(Click on the image to open gallery)</small></span>
    </p>
    {% if game.game_images %}
    <div class="image-gallery">
      {% with game_images=game.game_images|split_by_comma %}
      {% for game_image in game_images %}
      {% if forloop.counter == 1 %}
      <a href="{{ game_image }}" data-lightbox="game-images-{{ game.id }}" class="gallery-image">
        <img src="{{ game_image }}" alt="Game Image">
      </a>
      {% else %}
      <a href="{{ game_image }}" data-lightbox="game-images-{{ game.id }}" style="display: none;">
        <img src="{{ game_image }}" alt="Game Image">
      </a>
      {% endif %}
      {% endfor %}
      {% endwith %}
    </div>
    {% else %}
    <p><strong>Images not available</strong></p>
    {% endif %}
    {% zip_lists game.reviewers game.review_deck game.review_description game.score as zipped_data %}
    {% if not zipped_data %}
    <p><strong>Reviews:</strong> No reviews for this game yet.</p>
    {% else %}
    <div class="reviews-section">
      <p><strong>Reviews:</strong> <button class="show-hide-button" onclick="toggleReviews(this);">Show</button></p>
      <div class="reviews" style="display: none;">
        {% for reviewer, title, review_description, score in zipped_data %}
        {% if forloop.counter <= 5 %}
        <div class="review">
          <div class="review-header">
            <p><strong>Author:</strong> {{ reviewer }} - <span class="star-rating"><span class="score-hidden">{{ score }}</span></span></p>
            <p><strong>Title:</strong> {{ title }}</p>
          </div>
          <div class="review-body">
            <p><strong>Summary:</strong></p>
            <span class="review-description">{{ review_description|default:"N/A"|truncatewords_html:"50" }}</span>
            <span class="review-description-full" style="display: none;">{{ review_description|default:"N/A" }}</span>
            <button class="read-button-review" onclick="readMoreReview(this);">[Read more...]</button>
          </div>
          <div class="review-footer">
            <p><strong>Rating:</strong> {{ score }}</p>
          </div>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
  <span class="favorite-toggle" data-game-id="{{ game.id }}">
  {% if game.id|is_favorite:user_preferences.favorite_games %}
    <i class="fas fa-star" id="star-{{ game.id }}"></i>
  {% else %}
    <i class="far fa-star" id="star-{{ game.id }}"></i>
  {% endif %}
</span>
</li>

<script src="{% static 'js/lightbox-plus-jquery.min.js' %}"></script>
<script src="{% static 'js/playstyle_compass/star_rating.js' %}"></script>
<script src="{% static 'js/playstyle_compass/game_recommendations.js' %}"></script>